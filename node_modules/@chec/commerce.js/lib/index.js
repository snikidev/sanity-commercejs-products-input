'use strict';function _interopDefault(a){return a&&"object"==typeof a&&"default"in a?a["default"]:a}var _objectWithoutProperties=_interopDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_toConsumableArray=_interopDefault(require("@babel/runtime/helpers/toConsumableArray")),_typeof=_interopDefault(require("@babel/runtime/helpers/typeof")),_defineProperty=_interopDefault(require("@babel/runtime/helpers/defineProperty")),_classCallCheck=_interopDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass=_interopDefault(require("@babel/runtime/helpers/createClass")),_regeneratorRuntime=_interopDefault(require("@babel/runtime/regenerator")),_asyncToGenerator=_interopDefault(require("@babel/runtime/helpers/asyncToGenerator")),axios=_interopDefault(require("axios")),Storage=function(){function a(b){_classCallCheck(this,a),this.commerce=b}return _createClass(a,[{key:"set",value:function(a,b,c){var d,e="";if(d=this.commerce.options.config&&"undefined"!=typeof this.commerce.options.config.cookie_path?this.commerce.options.config.cookie_path:"/",c){var f=new Date;f.setTime(f.getTime()+1e3*(60*(60*(24*c)))),e="; expires="+f.toGMTString()}return document.cookie=a+"="+b+e+"; path="+d}},{key:"get",value:function(a){a+="=";for(var b,d=0,e=Array.from(document.cookie.split(";"));d<e.length;d++){for(b=e[d];" "===b.charAt(0);)b=b.substring(1,b.length);if(0===b.indexOf(a))return b.substring(a.length,b.length)}return null}},{key:"remove",value:function(a){return this.set(a,"",-1)}}]),a}(),Cart=function(){function a(b){_classCallCheck(this,a),this.commerce=b,this.cartId=null}return _createClass(a,[{key:"refresh",value:function(){var a=this;return this.commerce.request("carts").then(function(b){var c=b.id;return a.commerce.storage.set("commercejs_cart_id",c,30),a.cartId=c,b})}},{key:"id",value:function(){if(null!==this.cartId)return this.cartId;var a=this.commerce.storage.get("commercejs_cart_id");return"string"==typeof a&&a.length?a:null}},{key:"request",value:function(){var a=_asyncToGenerator(_regeneratorRuntime.mark(function a(){var b,c,d,e,f,g=this,h=arguments;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b=0<h.length&&void 0!==h[0]?h[0]:"",c=1<h.length&&void 0!==h[1]?h[1]:"get",d=2<h.length&&void 0!==h[2]?h[2]:null,e=!!(3<h.length&&void 0!==h[3])&&h[3],f="string"==typeof b&&b.length?"/".concat(b):"",this.id()){a.next=8;break}return a.next=8,this.refresh();case 8:return a.abrupt("return",this.commerce.request("carts/".concat(this.id()).concat(f),c,d,e).catch(function(a){if(a.statusCode&&404===a.statusCode)return g.refresh().then(function(){return g.commerce.request("carts/".concat(g.id()).concat(f),c,d,e)});throw a}));case 9:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}()},{key:"add",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d={id:"object"===_typeof(a)?a.id:a,quantity:b,variant:c};return this.request("","post",d)}},{key:"retrieve",value:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return b&&(this.cartId=b),this.request().then(function(b){return a.cartId=b&&b.id||null,b})}},{key:"remove",value:function(a){return this.request("items/".concat(a),"delete")}},{key:"delete",value:function(){return this.request("","delete")}},{key:"update",value:function(a,b){return this.request("items/".concat(a),"put",b)}},{key:"contents",value:function(){return this.request("items")}},{key:"empty",value:function(){return this.request("items","delete")}}]),a}(),Categories=function(){function a(b){_classCallCheck(this,a),this.commerce=b}return _createClass(a,[{key:"list",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return"function"==typeof a?this.commerce.request("categories"):this.commerce.request("categories","get",a)}},{key:"retrieve",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.commerce.request("categories/".concat(a),"get",b)}}]),a}(),Checkout=function(){function Checkout(a){_classCallCheck(this,Checkout),this.commerce=a}return _createClass(Checkout,[{key:"protect",value:function(token){return this.commerce.request("checkouts/".concat(token,"/protect")).then(function(data){return eval(data.sift_js)})}},{key:"generateToken",value:function(a,b){return this.commerce.request("checkouts/".concat(a),"get",b)}},{key:"generateTokenFrom",value:function(a,b){if(!["product_id","cart","permalink"].includes(a))throw new Error("Cannot generate a token with unknown \"".concat(a,"\" type"));return this.generateToken(b,{type:a})}},{key:"capture",value:function(a,b){var c=this;return this.commerce.request("checkouts/".concat(a),"post",b).then(function(a){return c.commerce.cart.refresh(),a})}},{key:"receipt",value:function(a){return this.commerce.request("checkouts/".concat(a,"/receipt"))}},{key:"checkPayWhatYouWant",value:function(a,b){return this.commerce.request("checkouts/".concat(a,"/check/pay_what_you_want"),"get",b)}},{key:"fields",value:function(a){return this.commerce.request("checkouts/".concat(a,"/fields"))}},{key:"setTaxZone",value:function(a,b){return this.commerce.request("checkouts/".concat(a,"/helper/set_tax_zone"),"get",b)}},{key:"getLocationFromIP",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",c=b.length?"?ip_address=".concat(b):"";return this.commerce.request("checkouts/".concat(a,"/helper/location_from_ip").concat(c))}},{key:"isFree",value:function(a){return this.commerce.request("checkouts/".concat(a,"/check/is_free"))}},{key:"checkVariant",value:function(a,b,c){return this.commerce.request("checkouts/".concat(a,"/check/").concat(b,"/variant"),"get",c)}},{key:"checkDiscount",value:function(a,b){return this.commerce.request("checkouts/".concat(a,"/check/discount"),"get",b)}},{key:"checkShippingOption",value:function(a,b){return this.commerce.request("checkouts/".concat(a,"/check/shipping"),"get",b)}},{key:"getShippingOptions",value:function(a,b){return this.commerce.request("checkouts/".concat(a,"/helper/shipping_options"),"get",b)}},{key:"checkQuantity",value:function(a,b,c){return this.commerce.request("checkouts/".concat(a,"/check/").concat(b,"/quantity"),"get",c)}},{key:"helperValidation",value:function(a){return this.commerce.request("checkouts/".concat(a,"/helper/validation"))}},{key:"getLive",value:function(a){return this.commerce.request("checkouts/".concat(a,"/live"))}},{key:"getToken",value:function(a){return this.commerce.request("checkouts/tokens/".concat(a))}},{key:"checkGiftcard",value:function(a,b){return this.commerce.request("checkouts/".concat(a,"/check/giftcard"),"get",b)}}]),Checkout}(),Merchants=function(){function a(b){_classCallCheck(this,a),this.commerce=b}return _createClass(a,[{key:"about",value:function(){return this.commerce.request("merchants")}}]),a}(),Products=function(){function a(b){_classCallCheck(this,a),this.commerce=b}return _createClass(a,[{key:"list",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return this.commerce.request("products","get",a)}},{key:"retrieve",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.commerce.request("products/".concat(a),"get",b)}}]),a}(),Services=function(){function a(b){_classCallCheck(this,a),this.commerce=b}return _createClass(a,[{key:"localeListCountries",value:function(){return this.commerce.request("services/locale/countries")}},{key:"localeListShippingCountries",value:function(a){return this.commerce.request("services/locale/".concat(a,"/countries"))}},{key:"localeListShippingSubdivisions",value:function(a,b){return this.commerce.request("services/locale/".concat(a,"/countries/").concat(b,"/subdivisions"))}},{key:"localeListSubdivisions",value:function(a){return this.commerce.request("services/locale/".concat(a,"/subdivisions"))}}]),a}(),Features={Cart:Cart,Categories:Categories,Checkout:Checkout,Merchants:Merchants,Products:Products,Services:Services},consoleHelper=function(){var d,e,f,g,h,j=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"black",k=1<arguments.length?arguments[1]:void 0,l=2<arguments.length?arguments[2]:void 0,b=3<arguments.length?arguments[3]:void 0,c="White",m=!1;if("success"===j?(j="#488f5a",d="\u2705   "):"info"===j?(j="DodgerBlue",d=""):"error"===j?("validation"===b.error.type?(j="rgba(244, 67, 54, 1)",d="\uD83D\uDEAB Validation/Missing Fields",k=""):(j="rgba(244, 67, 54, 1)",d="\u274C HTTP ERROR ",c="rgba(244, 67, 54, 0.15)"),m=!0):"warning"===j?(j="rgba(208, 154, 35, 1)",d="\u26A0\uFE0F  "):void 0,!0===m){if(console.log("%c"+d+k,"color:"+j+";display:block; width: 100%;padding:2px 2px 2px 0px;font-family: Open Sans, Helvetica, Sans-serif;font-weight:bold;background-color:"+c+";"),"object"===_typeof(b.error.message)){for(g=b.error.message,e=0,f=g.length,h=[];e<f;)console.log("%c"+g[e].field+" %c"+g[e].error,"color:#515D6D;font-family: Open Sans, Helvetica, Sans-serif;font-weight:800;","color:#515D6D;font-family: Open Sans, Helvetica, Sans-serif;font-weight:400;"),h.push(e++);return h}return console.log("%c"+b.error.message,"color:#515D6D;font-family: Open Sans, Helvetica, Sans-serif;font-weight:400;")}return"object"===_typeof(j)?(console.log("%c"+k,"color: PowderBlue;font-weight:bold;font-family: Open Sans, Helvetica, Sans-serif; background-color: RoyalBlue;"),void console.log(j)):void(console.log("%c"+d+k,"color:"+j+";display:block;font-family: Open Sans, Helvetica, Sans-serif;line-height:28px; width: 100%;padding:2px 2px 2px 0px;font-weight:bold;background-color:"+c+";"),l&&console.log("%c"+l,"color:#515D6D;line-height:22px;font-weight:400; font-family: Open Sans, Helvetica, Sans-serif;"))},debuggerOnNotice=function(){console.log("%c\r\n \r\n                           Che         EcC\r\n                         c....c2    2c....:C\r\n                       c........c2   2c.....:C\r\n                     c............c2   2c.....:C\r\n                   c................c2   2c.....:C\r\n                 c....................c2   2c.....:C\r\n               c........................c2   2c.....:C\r\n             c............................c2   2c.....:C\r\n           c.......:E2  2c..................c2   2c.....:C\r\n         c........h  $$   2c..................c2   2c.....:C\r\n       c.........:C  $cc$  E....................c2   2c.....:C\r\n     c............h    $$  c......................c2   2c.....:C\r\n   c...............:E    E:.........................c2   2c.....:C\r\n   E............................:C c..................h2   2c...:C\r\n     E........................:C     c..................h2   2hC\r\n       E....................:C         c..................h2\r\n         E................:C             c................:C\r\n           E............:C                 c............:C\r\n             E........:C                     c........:C\r\n               E....:C                         c....:C\r\n                 EcC                             EcC\r\n \r\n \r\n \r\n","font-family: Courier New, Courier, monospace; color: #788ba4; font-weight:bold; font-size: 11px;"),console.log("%cCommerce.js console debugger is on!  \uD83C\uDF89","text-align:center; display:block; font-family: Open Sans, Helvetica, Sans-serif; color: #488f5a; line-height:28px; font-size: 14px"),console.log("%c\uD83D\uDCAC   Need some help? Join our Slack channel - https://chec-commercejs-community.herokuapp.com \r\n","text-align:center; display:block; font-family: Open Sans, Helvetica, Sans-serif; color: #515D6D; line-height:20px; font-size: 12px")};function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(b,!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}var defaultEventCallback=function(a){var b=new CustomEvent("Commercejs.".concat(a),{bubbles:!1,cancelable:!1});return window.dispatchEvent(b)},Commerce=function(){function a(b){var c=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(_classCallCheck(this,a),this.options=_objectSpread({version:"v1",url:"https://api.chec.io/",eventCallback:defaultEventCallback},d,{publicKey:b,debug:c}),("string"!=typeof b||0===b.length)&&console.warn("\u26A0\uFE0F Invalid public key given to Commerce.js client"),"sk_"===b.toLowerCase().substring(0,3))throw new Error("Secret key provided. You must use a public key with Commerce.js!");this.storage=new Storage(this),this.cart=new Features.Cart(this),this.checkout=new Features.Checkout(this),this.products=new Features.Products(this),this.services=new Features.Services(this),this.categories=new Features.Categories(this),this.merchants=new Features.Merchants(this),c&&(this.consoleHelper=consoleHelper,debuggerOnNotice())}return _createClass(a,[{key:"error",value:function(a){if(this.consoleHelper&&this.options.debug){var b=a.response,c="[".concat(b.status,"] Type: ").concat(b.statusText),d="string"==typeof b.data?b.data:b.statusText;return this.consoleHelper("error",c,d,b.data)}}},{key:"request",value:function(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"get",d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3],f={"X-Authorization":this.options.publicKey,"X-Chec-Agent":"commerce.js/v2"},g="get"===c?d:null,h="get"===c?null:d,i=this.options.timeoutMs||6e4,j=this.options.axiosConfig||{},k=this.options.url;"/"!==k.substring(k.length-1)&&(k+="/");var l=axios(_objectSpread({url:a,method:c,baseURL:"".concat(k).concat(this.options.version,"/"),params:g,data:h,timeout:i},j,{headers:_objectSpread({},f,{},j.headers)}));if(e)return l;var m=this.options.eventCallback;return l.then(function(a){if(b.consoleHelper&&b.options.debug&&"object"===_typeof(a.data._console)&&b.consoleHelper.apply(b,_toConsumableArray(a.data._console)),"object"!==_typeof(a.data)||Array.isArray(a.data))return a.data;var c=a.data,d=c._event,e=_objectWithoutProperties(c,["_event"]);return"string"==typeof d&&"function"==typeof m&&m(d),e}).catch(function(a){throw b.error(a),{message:"Unsuccessful response (".concat(a.response.status,": ").concat(a.response.statusText,") received"),statusCode:a.response.status,statusText:a.response.statusText,data:a.response.data,originalError:a}})}}]),a}();module.exports=Commerce;
