"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Avatar = void 0;
var auto_id_1 = require("@reach/auto-id");
var react_1 = __importStar(require("react"));
var react_is_1 = __importDefault(require("react-is"));
var styled_components_1 = __importStar(require("styled-components"));
var styles_1 = require("../../styles");
var focusRing_1 = require("../../styles/_internal/focusRing");
var theme_1 = require("../../theme");
var text_1 = require("../text");
function responsiveAvatarSizeStyle(props) {
    var theme = props.theme;
    var _a = theme.sanity, avatar = _a.avatar, media = _a.media;
    return styles_1.responsive(media, props.size, function (size) {
        var avatarSize = avatar.sizes[size];
        if (!avatarSize)
            return {};
        return {
            width: styles_1.rem(avatarSize.size),
            height: styles_1.rem(avatarSize.size),
            borderRadius: styles_1.rem(avatarSize.size / 2),
            '& > svg': {
                width: styles_1.rem(avatarSize.size),
                height: styles_1.rem(avatarSize.size),
                borderRadius: styles_1.rem(avatarSize.size / 2),
            },
        };
    });
}
var Root = styled_components_1.default.div(responsiveAvatarSizeStyle, function (_a) {
    var theme = _a.theme, uiColor = _a.uiColor;
    var focusRing = theme.sanity.focusRing;
    return styled_components_1.css(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n      background-color: ", ";\n      position: relative;\n      box-sizing: border-box;\n      user-select: none;\n      box-shadow: 0 0 0 1px var(--card-bg-color);\n\n      &[data-status='inactive'] {\n        opacity: 0.5;\n      }\n\n      & > svg {\n        &:not([hidden]) {\n          display: block;\n        }\n      }\n\n      /* &:is(button) */\n      &[data-as='button'] {\n        appearance: none;\n        margin: 0;\n        padding: 0;\n        border: 0;\n        font: inherit;\n        -webkit-font-smoothing: inherit;\n        color: inherit;\n        outline: none;\n\n        &:focus {\n          box-shadow: ", ";\n        }\n\n        &:focus:not(:focus-visible) {\n          box-shadow: none;\n        }\n      }\n    "], ["\n      background-color: ", ";\n      position: relative;\n      box-sizing: border-box;\n      user-select: none;\n      box-shadow: 0 0 0 1px var(--card-bg-color);\n\n      &[data-status='inactive'] {\n        opacity: 0.5;\n      }\n\n      & > svg {\n        &:not([hidden]) {\n          display: block;\n        }\n      }\n\n      /* &:is(button) */\n      &[data-as='button'] {\n        appearance: none;\n        margin: 0;\n        padding: 0;\n        border: 0;\n        font: inherit;\n        -webkit-font-smoothing: inherit;\n        color: inherit;\n        outline: none;\n\n        &:focus {\n          box-shadow: ", ";\n        }\n\n        &:focus:not(:focus-visible) {\n          box-shadow: none;\n        }\n      }\n    "])), uiColor, focusRing_1.focusRingStyle({ focusRing: focusRing }));
});
var Arrow = styled_components_1.default.div(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  position: absolute;\n  box-sizing: border-box;\n  z-index: 0;\n  opacity: 0;\n  transition: all 0.2s linear;\n  transform: rotate(-90deg) translate3d(0, 6px, 0);\n\n  & > svg {\n    width: 11px;\n    height: 7px;\n    position: absolute;\n    top: -5px;\n    left: 50%;\n    transform: translateX(-50%);\n\n    &:not([hidden]) {\n      display: block;\n    }\n  }\n\n  [data-arrow-position='inside'] > & {\n    transform: rotate(-90deg) translate3d(0, 6px, 0);\n    opacity: 0;\n  }\n\n  [data-arrow-position='top'] > & {\n    opacity: 1;\n    transform: rotate(0deg);\n  }\n\n  [data-arrow-position='bottom'] > & {\n    opacity: 1;\n    transform: rotate(-180deg);\n  }\n"], ["\n  position: absolute;\n  box-sizing: border-box;\n  z-index: 0;\n  opacity: 0;\n  transition: all 0.2s linear;\n  transform: rotate(-90deg) translate3d(0, 6px, 0);\n\n  & > svg {\n    width: 11px;\n    height: 7px;\n    position: absolute;\n    top: -5px;\n    left: 50%;\n    transform: translateX(-50%);\n\n    &:not([hidden]) {\n      display: block;\n    }\n  }\n\n  [data-arrow-position='inside'] > & {\n    transform: rotate(-90deg) translate3d(0, 6px, 0);\n    opacity: 0;\n  }\n\n  [data-arrow-position='top'] > & {\n    opacity: 1;\n    transform: rotate(0deg);\n  }\n\n  [data-arrow-position='bottom'] > & {\n    opacity: 1;\n    transform: rotate(-180deg);\n  }\n"])));
var BgStroke = styled_components_1.default.ellipse(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  stroke-width: 4px;\n  stroke: var(--card-bg-color);\n"], ["\n  stroke-width: 4px;\n  stroke: var(--card-bg-color);\n"])));
var Stroke = styled_components_1.default.ellipse(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  stroke-width: 3px;\n\n  ", "[data-status='editing'] & {\n    stroke-dasharray: 2 4;\n    stroke-linecap: round;\n    animation: avatarEditingSpin 250ms infinite linear;\n  }\n"], ["\n  stroke-width: 3px;\n\n  ", "[data-status='editing'] & {\n    stroke-dasharray: 2 4;\n    stroke-linecap: round;\n    animation: avatarEditingSpin 250ms infinite linear;\n  }\n"])), Root);
var Initials = styled_components_1.default.div(function (props) {
    var theme = props.theme;
    var base = theme.sanity.color.base;
    return styled_components_1.css(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n    width: 100%;\n    height: 100%;\n    color: ", ";\n    align-items: center;\n    justify-content: center;\n    text-transform: uppercase;\n    text-align: center;\n    border-radius: 50%;\n\n    &:not([hidden]) {\n      display: flex;\n    }\n  "], ["\n    width: 100%;\n    height: 100%;\n    color: ", ";\n    align-items: center;\n    justify-content: center;\n    text-transform: uppercase;\n    text-align: center;\n    border-radius: 50%;\n\n    &:not([hidden]) {\n      display: flex;\n    }\n  "])), base.fg);
});
exports.Avatar = react_1.forwardRef(function (props, ref) {
    var asProp = props.as, _a = props.color, colorKey = _a === void 0 ? 'gray' : _a, src = props.src, title = props.title, initials = props.initials, onImageLoadError = props.onImageLoadError, arrowPositionProp = props.arrowPosition, animateArrowFrom = props.animateArrowFrom, _b = props.status, status = _b === void 0 ? 'online' : _b, sizeProp = props.size, restProps = __rest(props, ["as", "color", "src", "title", "initials", "onImageLoadError", "arrowPosition", "animateArrowFrom", "status", "size"]);
    var as = react_is_1.default.isValidElementType(asProp) ? asProp : 'div';
    var size = styles_1.getResponsiveProp(sizeProp, [0]);
    var theme = theme_1.useTheme();
    var color = theme.sanity.color.spot[colorKey] || theme.sanity.color.spot.gray;
    // @todo: remove this
    var avatarSize = theme.sanity.avatar.sizes[size[0]];
    var _sizeRem = avatarSize.size;
    var _radius = _sizeRem / 2;
    var elementId = auto_id_1.useId();
    var _c = react_1.useState(animateArrowFrom || arrowPositionProp || 'inside'), arrowPosition = _c[0], setArrowPosition = _c[1];
    var _d = react_1.useState(false), imageFailed = _d[0], setImageFailed = _d[1];
    react_1.useEffect(function () {
        if (arrowPosition === arrowPositionProp)
            return undefined;
        // Start animation in the next frame
        var raf = requestAnimationFrame(function () { return setArrowPosition(arrowPositionProp); });
        return function () { return cancelAnimationFrame(raf); };
    }, [arrowPosition, arrowPositionProp]);
    react_1.useEffect(function () {
        if (src)
            setImageFailed(false);
    }, [src]);
    var handleImageError = react_1.useCallback(function () {
        setImageFailed(true);
        if (onImageLoadError) {
            onImageLoadError(new Error('Avatar: the image failed to load'));
        }
    }, [onImageLoadError]);
    return (react_1.default.createElement(Root, __assign({ as: as, "data-as": String(as) || 'div', "data-ui": "Avatar" }, restProps, { "aria-label": title, "data-arrow-position": arrowPosition, "data-status": status, ref: ref, size: size, title: title, uiColor: color }),
        react_1.default.createElement(Arrow, null,
            react_1.default.createElement("svg", { width: "11", height: "7", viewBox: "0 0 11 7", fill: "none" },
                react_1.default.createElement("path", { d: "M6.67948 1.50115L11 7L0 7L4.32052 1.50115C4.92109 0.736796 6.07891 0.736795 6.67948 1.50115Z", fill: color }))),
        !imageFailed && src && (react_1.default.createElement("svg", { viewBox: "0 0 " + _sizeRem + " " + _sizeRem, fill: "none" },
            react_1.default.createElement("defs", null,
                react_1.default.createElement("pattern", { id: elementId + "-image-url", patternContentUnits: "objectBoundingBox", width: "1", height: "1" },
                    react_1.default.createElement("image", { href: src, width: "1", height: "1", onError: handleImageError }))),
            react_1.default.createElement("circle", { cx: _radius, cy: _radius, r: _radius, fill: "url(#" + elementId + "-image-url)" }),
            react_1.default.createElement(BgStroke, { cx: _radius, cy: _radius, rx: _radius, ry: _radius, vectorEffect: "non-scaling-stroke" }),
            react_1.default.createElement(Stroke, { cx: _radius, cy: _radius, rx: _radius, ry: _radius, stroke: color, vectorEffect: "non-scaling-stroke" }))),
        (imageFailed || !src) && initials && (react_1.default.createElement(react_1.default.Fragment, null,
            react_1.default.createElement(Initials, null,
                react_1.default.createElement(text_1.Text, { as: "span", size: size.map(function (s) { return (s === 0 ? 0 : s + 1); }) },
                    react_1.default.createElement("strong", null, initials)))))));
});
exports.Avatar.displayName = 'Avatar';
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5;
//# sourceMappingURL=avatar.js.map